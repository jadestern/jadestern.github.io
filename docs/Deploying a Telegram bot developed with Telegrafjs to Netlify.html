
  <html lang="ko">
    <head>
      <meta charset="utf-8">
      <title>Deploying a Telegram bot developed with Telegraf.js to Netlify</title>
      <link rel="canonical" href="https://blog.devgenius.io/deploying-a-telegram-bot-developed-with-telegraf-js-aef341ec0d4f">
      <style>
        pre {
          padding: 1rem;
          background-color: #263238;
          color: #fff
        }
      </style>
    </head>
    <body>
      <article>
        <div id="readability-page-1" class="page"><div><h2 id="743d">코드</h2><h2 id="e368">package.json</h2><p id="556e">터미널을 통해 새로 복제된 디렉토리로 이동한 후 다음을 입력합니다:</p><pre translate="no"><span id="a841">npm init -y</span></pre><p id="dc49">이렇게 하면 기본 키가 이미 채워진 새 <em>package.json이</em> 생성되며, <em>"name</em> " 키에 원하는 이름이 있는지 확인하세요(기본값은 폴더의 이름과 동일).</p><p id="94b1">또한, 다음 명령을 실행하세요:</p><pre translate="no"><span id="94bf">npm install telegraf<br>npm install netlify-lambda</span></pre><p id="ed43"><a href="https://telegraf.js.org/" rel="noopener ugc nofollow" target="_blank">Telegraf.js</a> (작성 당시, 최신 버전은 4.9.0)는 <em>"Node.js용 텔레그램 봇 API 프레임워크"</em>로, 코드를 통해 텔레그램의 API 사용을 (많이) 단순화 시켜줍니다. 프레임워크를 사용하지 않고 "순수한" 방법을 시도해 보았지만, 텔레그램 API 설명서를 이해하는데 많은 시간이 소요되어 그만한 가치가 없었습니다.</p><p id="3615">넷라이파이-람다는 <em>"로컬과 CI 환경에서 람다 함수를 빌드하고 제공하는데 도움을 주는"</em> 도구입니다.</p><h2 id="625b">netlify.toml</h2><p id="0766"><em>package.json과</em> 같은 디렉터리에 다음 내용이 포함된 <em>netlify.toml이라는 </em>파일도 만듭니다(수정 09/10/2022: <a href="https://medium.com/u/962f9e337686?source=post_page-----aef341ec0d4f--------------------------------" rel="noopener" target="_blank">Anais Reyes가</a> 이전 .toml 파일의 오류를 올바르게 지적하여 현재 수정됨):</p><pre translate="no"><span id="c46d">[build]<br>  functions = "functions"<br>  command = "netlify-lambda install &amp;&amp; mkdir ./public"<br>[[redirects]]<br>  from = "/api/*"<br>  to = "/.netlify/functions/:splat"<br>  status = 200</span></pre><p id="42c0">이 구성 파일은 빌드 및 배포 중에 Netlify에서 사용됩니다. 자세한 내용은 <a href="https://docs.netlify.com/configure-builds/file-based-configuration/" rel="noopener ugc nofollow" target="_blank">Netlify 문서에서</a> 확인할 수 있습니다.</p><h2 id="7881">하위 폴더</h2><p id="ddef">이제 이러한 하위 폴더를 만들어야 합니다:</p><ul><li id="f9db"><strong>functions</strong></li><li id="4700"><strong>functions/bot</strong> (참고로 이 하위 폴더는 첫 번째 폴더 <strong>안에 </strong>있어야 합니다).</li></ul><h2 id="53f6">bot.js</h2><p id="d977">이제 채팅에서 "/start" 명령을 받으면 "Hi"로 응답하는 기본 봇을 작성해 보겠습니다.</p><p id="650c"><em>functions/bot</em> 하위 폴더에 <em>bot.js라는</em> 파일을 만들어야 합니다.</p><figure><figcaption>bot.js 소스 코드</figcaption></figure><blockquote><p id="5c8b">이 봇이 Netlify 함수와 함께 작동하는 데 필수적일 뿐만 아니라 모든 튜토리얼에서 언급하는 것을 잊은 부분인 <strong>exports.handler</strong> (AWS 이벤트 핸들러 구문이라고 함)의 구문에 유의하세요.</p></blockquote><h2 id="ace8">.gitignore</h2><p id="393d">프로젝트의 루트 디렉터리에 <a href="https://git-scm.com/docs/gitignore" rel="noopener ugc nofollow" target="_blank">.gitignore</a> 파일을 생성하고 간단히 입력합니다:</p><pre translate="no"><span id="983d">node_modules</span></pre><h2 id="b301">최종 폴더 구조</h2><p id="e67f"><em>npm 설치 </em>명령을 실행하면 다음과 같은 폴더 구조가 됩니다:</p><pre translate="no"><span id="f8bf">.<br>├── .git/ (automatically created when cloning the repository)<br>├── functions/<br>│   └── bot/<br>│       └── bot.js<br>├── node_modules/<br>│   └── &lt;dependencies files&gt;<br>├── .gitignore<br>├── netlify.toml<br>├── package.json<br>└── package-lock.json (auto-generated after running npm install)</span></pre><p id="972b">좋습니다! 이제 "코딩"이 완료되었으므로 모든 것을 <strong>커밋하고</strong> 리포지토리에 <strong>푸시합니다</strong>.</p></div><div><h2 id="e851">Netlify</h2><h2 id="7a98">사이트 배포</h2><p id="139c">코드를 Github에 푸시한 후 Netlify에 로그인해 보겠습니다. 여기서 해야 할 일은 다음과 같습니다:</p><ul><li id="4306">새 사이트를 만듭니다( <strong>기존 프로젝트 가져오기를</strong> 선택하여).</li><li id="9e71">Github(또는 버전 관리 시스템 제공업체)를 선택합니다.</li><li id="4641">봇 코드를 푸시한 리포지토리를 선택합니다.</li><li id="873c">기본 설정을 확인합니다(제 경우에는 필드를 비워둔 채<strong> /dist에서 </strong>"게시 디렉토리"의 기본값을 변경해야 했습니다).</li></ul><figure><figcaption>기본 사이트 설정.</figcaption></figure><ul><li id="98dd">BotFather에서 제공하는 텔레그램 봇 토큰을 저장해야 합니다. 이렇게 하려면 <strong>고급 표시를 </strong>클릭한 다음 <strong>새 변수를</strong>클릭합니다. <strong><br></strong><em> </em> 변수의 <em>키는 </em> <strong>BOT_TOKEN이어야 </strong>하며 BotFather에서 제공한 봇의 토큰을 값 필드에 붙여넣어야 합니다.</li></ul><figure><figcaption>환경 변수 설정을 클릭합니다.</figcaption></figure><ul><li id="3df9"><strong>사이트 배포를</strong> 클릭합니다. 원하는 경우 <strong>사이트 이름을</strong> 사용자 지정할 수 있습니다(사이트 설정 &gt; 도메인 관리 &gt; 옵션 &gt; 사이트 이름 편집).</li></ul><figure><figcaption>사이트 이름 사용자 지정 페이지</figcaption></figure><h2 id="459b">웹훅</h2><p id="edff">이제, 사용자가 보낸 모든 메시지를 봇에게 전달할 위치를 텔레그램에 알려주어야 합니다. 이를 위해서는, 웹훅을 설정해야 합니다.</p><p id="2be9">아래 URL을 복사하여, <strong>&lt;your_bot_token&gt;과 </strong> <strong>&lt;your_site_name&gt;을</strong> 바꾸고, 브라우저 주소창에 붙여넣고 이동합니다.</p><pre translate="no"><span id="2eef">https://api.telegram.org/bot<strong>&lt;your_bot_token&gt;</strong>/setWebhook?url=https://<strong>&lt;your_site_name&gt;</strong>.netlify.app/api/bot</span></pre><p id="2954">예를 들어, 제 URL은 다음과 같습니다(봇 토큰은 이제 유효하지 않으니 걱정하지 마세요):</p><pre translate="no"><span id="9217">https://api.telegram.org/bot5594307469:AAEx9aeF6KeOMaQeAGJ79xa-tAB5RkWOdlg/setWebhook?url=https://venerable-alfajores-c6f46a.netlify.app/api/bot</span></pre><p id="3bca">웹훅이 올바르게 설정되었다면 다음과 같은 결과가 표시됩니다:</p><pre translate="no"><span id="5e95">{"ok":true,"result":true,"description":"Webhook was set"}</span></pre></div></div>
      </article>
    </body>
  </html>
  